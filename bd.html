<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Bullet Dodge</title>
<style>
body {
        background: #a2a5aa;
      }
header{
        margin: auto;
        text-align: center;
        font-size: 55px;
        color: #d5d815;
        text-shadow: 2px 2px 0 red;
      }
canvas {
    background:url(court.png);
       }
</style>

</head>
    <body onload="startGame()">
        <!--  https://github.com/goldfire/howler.js -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.0.5/howler.js"></script>
        <header>
            <img src="logo.png" alt="Logo">
        </header>
<script>

var player;
var enemy;
var bullet;
var ebullet;
var laser;

//sounds
let shootSound;
let laserSound;

function startGame() {
    Arena.start();
    player = new component(30, 80, "blue", 10, 8);
    enemy = new component(30, 80, "red", 1213, 606);
    bullet = new component(50, 2, "yellow", -800, 73);
    ebullet = new component(50, 2, "yellow", 2030, 612);
    laser = new component(20, 660,"rgba(0,255,0,0.4)", 630, 30);
}

var Arena = {
    canvas : document.createElement("canvas"),
    start : function() {
        this.canvas.width = 1280;
        this.canvas.height = 720;
        this.canvas.setAttribute('style', "position: absolute; left: 50%; margin-left: -650px; top: 50%; margin-top: -320px; border: 2px solid black");
        this.context = this.canvas.getContext("2d");
        document.body.insertBefore(this.canvas, document.body.childNodes[0]);
        this.interval = setInterval(updateGameArena, 20);
        window.addEventListener('keydown', function (e) {
            Arena.keys = (Arena.keys || []);
            Arena.keys[e.keyCode] = (e.type == "keydown");
        })
        window.addEventListener('keyup', function (e) {
            Arena.keys[e.keyCode] = (e.type == "keydown");            
        })

	   // Load Sounds
    shootSound = new Howl({
	        src: ['bullet_fire.mp3']
});

    laserSound = new Howl({
	        src: ['laser.mp3']
});

    }, 
    clear : function(){
        this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
    }
}

function component(width, height, color, x, y) {
        this.gamearea = Arena;
        this.width = width;
        this.height = height;
        this.speedX = 0;
        this.speedY = 0;
        this.x = x;
        this.y = y;
    this.update = function() {
        ctx = Arena.context;
        ctx.fillStyle = color;
        ctx.fillRect(this.x, this.y, this.width, this.height);
    }
    this.newPos = function() {
        this.x += this.speedX;
        this.y += this.speedY;        
    }    
}

function setBoundaries(){
    // For player
    if (player.x < 37) {
        player.x = 37;
    }
    if (player.y < 35) {
        player.y = 35;
    }
    if (player.y + player.height > 700) {
        player.y = 700 - player.height;
    }

    // For enemy
    if (enemy.x < 37) {
        enemy.x = 37;
    }
    if (enemy.y < 35) {
        enemy.y = 35;
    }
    if (enemy.y + enemy.height > 700) {
        enemy.y = 700 - enemy.height;
    }

    // Laser Death for player! 
    if (player.x + player.width == 635) {
        player.x = 10;
        player.y = 8;
        bullet.x = -700;
        bullet.y = 73;
    // play laser sound
        laserSound.play();
    }

    // Laser Death for enemy! 
    if (enemy.x + enemy.width == 635) {
        enemy.x = 1213;
        enemy.y = 606;
        ebullet.x = 2030;
        ebullet.y = 612;
    // play laser sound
        laserSound.play();
    }

    // For bullets
    if (bullet.y < 70) {
        bullet.y = 70;
    }
    if (bullet.y + bullet.height > 659) {
        bullet.y = 659 - bullet.height;
    }

    // For enemy bullets
    if (ebullet.y < 70) {
        ebullet.y = 70;
    }
    if (ebullet.y + ebullet.height > 659) {
        ebullet.y = 659 - ebullet.height;
    }
}

function hitDetection (){
    // enemy damage
    if (bullet.x > enemy.x && bullet.x < (enemy.x + 30) && bullet.y > enemy.y && bullet.y < (enemy.y + 80)) {
        laserSound.play();
    }
    // player damage
    if (ebullet.x > player.x && ebullet.x < (player.x + 30) && ebullet.y > player.y && ebullet.y < (player.y + 80)) {
        laserSound.play();
    }
}

function updateGameArena() {
    Arena.clear();
    setBoundaries();
    hitDetection();
    player.speedX = 0;
    player.speedY = 0;
    enemy.speedX = 0;
    enemy.speedY = 0;
    bullet.speedX = 0;
    bullet.speedY = 0;
    ebullet.speedX = 0;
    ebullet.speedY = 0;

    // controls for player
    // Uses WASD for movement and space for fire
    if (Arena.keys && Arena.keys[65]) {player.speedX = -4; bullet.speedX = -4;}
    if (Arena.keys && Arena.keys[68]) {player.speedX = 4; bullet.speedX = 4;}
    if (Arena.keys && Arena.keys[87]) {player.speedY = -4; bullet.speedY = -4;}
    if (Arena.keys && Arena.keys[83]) {player.speedY = 4; bullet.speedY = 4;}
    if (Arena.keys && Arena.keys[32]) {bullet.x = bullet.x + 105;}

    // make bullet return to player
    if (bullet.x >= 1230){
        bullet.x = player.x;
        // play bullet sound
        shootSound.play();
    }

    // controls for foe
    // Uses numpad 8456 for movement and down arrow for fire
    if (Arena.keys && Arena.keys[100]) {enemy.speedX = -4; ebullet.speedX = -4;}
    if (Arena.keys && Arena.keys[102]) {enemy.speedX = 4; ebullet.speedX = 4;}
    if (Arena.keys && Arena.keys[104]) {enemy.speedY = -4; ebullet.speedY = -4;}
    if (Arena.keys && Arena.keys[101]) {enemy.speedY = 4; ebullet.speedY = 4;}
    if (Arena.keys && Arena.keys[40]) {ebullet.x = ebullet.x - 105;}


    // make bullet return to enemy
    if (ebullet.x <= 50){
        ebullet.x = enemy.x;
        // play bullet sound
        shootSound.play();
  }
    // update positions
    player.newPos();
    enemy.newPos();
    bullet.newPos();
    ebullet.newPos();
    laser.newPos();
    enemy.update();
    player.update();
    bullet.update();
    ebullet.update();
    laser.update();
}
    </script>
    </body>
</html>